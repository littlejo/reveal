= PrÃ©sentation du terrain d'action
:imagesdir: assets/default/images
image::mi-action.png[]
//mi-4
[NOTE.speaker]
====
Maintenant que notre environnement d'entraÃ®nement est en place, il est temps de dÃ©finir le terrain d'action pour nos dÃ©ploiements.
====

== Choix stratÃ©gique : AWS EKS

[NOTE.speaker]
====
AWS : Service cloud d'Amazon

EKS : Service managÃ© de Kubernetes

ğŸ§­ Pourquoi EKS ?

* âœ… maÃ®trise d'AWS et d'EKS
* ğŸ›¡ï¸ Confiance pour supporter 511 clusters
====

== Limites imposÃ©es par AWS

image::service-quota.png[]

[NOTE.speaker]
====
ğŸ“ RÃ©alitÃ© du terrain : impossible de crÃ©er plus de 100 clusters EKS

ğŸ—£ï¸ ProcÃ©dure dâ€™obtention : NÃ©gociation avec AWS

â³ RÃ©sultat : plusieurs semaines de pourparlers.

ğŸšª Conclusion : AWS refuse 511 sur un seul compte

âœ… Solution trouvÃ©e : limite nÃ©gociÃ©e Ã  256 clusters
====

== Bonnes pratiques vs RÃ©alitÃ© opÃ©rationnelle

[NOTE.speaker]
====
ğŸ’¡ Recommandation officielle dâ€™AWS : â€œUn VPC par cluster EKSâ€

ğŸš« Limite rÃ©elle : â€œMax 5 VPCs par rÃ©gion.â€

ğŸ§¨ Plan B activÃ© : â€œUn seul VPC pour tous les clusters.â€

ğŸ§© RÃ©sultat :
* Anti-pattern complet âœ…
====

== Architecture proposÃ©e

image::aws-archi.svg[width=50%]

[NOTE.speaker]
====
Voici l'architecture que j'ai mis au point pour essayer de dÃ©ployer jusqu'Ã  256 clusters Kubernetes
On a un compte AWS, un VPC, un rÃ©seau privÃ©. Ã€ l'intÃ©rieur il contient 4 sous-rÃ©seaux 2 publics 2 privÃ©s
Dans les sous-rÃ©seaux public il y a une NAT Gateway pour pouvoir tÃ©lÃ©charger les images des containers
Dans les rÃ©seaux privÃ©, il y a les clusters EKS avec une seule EC2 et un control plane
====

== ParallÃ©lisation des connexions

image::connection-answer.png[width=45%]
[NOTE.speaker]
====
Une des principales difficultÃ©s de la mission est la crÃ©ation des connexions. Je vous prÃ©sente la premiÃ¨re tentative pour parallÃ©liser les connexions.

La contrainte : pas de crÃ©ation des connexions d'un mÃªme cluster en parallÃ¨le

Ainsi avec cet algorithme, avec 6 clusters kubernetes on a 5 Ã©tapes.

Avec cet algorithme, on passe d'une complexitÃ© de O(n2) Ã  O(n).
====

== 16 clusters

image::16-clusters.apng[width=50%]

[NOTE.speaker]
====
Le test de 32 clusters a Ã©chouÃ©, j'ai rÃ©duit la voilure Ã  16 clusters

âŒ Mur technique dÃ©tectÃ© :

* ğŸ“¦ Trop dâ€™objets Pulumi â†’ explosion de la RAM ğŸ’¥
* ğŸ” Connexions entre clusters â†’ explosion du CPU
  * 1 connexion â‰ˆ 1 CPU utilisÃ©
  * 128 connexions = 128 CPUs ? ğŸ˜…

ğŸ“‰ RÃ©sultat :

* âœ… 16 clusters connectÃ©s
* â±ï¸ 45 minutesâ€¦
* ğŸš« Bien trop long pour 511 clusters

ğŸ’¡ Conclusion :
    Il faut une autre stratÃ©gie de connexion.
====
